<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="reservationMapper">
	<!-- 현재 예약 리스트 중복 쿼리문 -->
	<sql id="list">
		select * from gr_reservation
		<if test="#{de_licencenum}!=null">
			where  = #{de_licencenum}
		</if><if test="">
			where  = #{who}
		</if>
		and re_date <![CDATA[>=]]> date_add(now(), interval -1 day)
		order by RE_DATE desc
	</sql>
	<!-- 현재 예약 리스트() -->
	<select id="getReservList" parameterType="ReservationDTO" resultType="ReservationDTO">
			<include refid="list">
				<property name="type" value="#{type}"/>
				<property name="who" value="#{who}"/>
			</include>
	</select>
	
	<!-- 예약 내역 리스트 -->
	<select id="getAllMyList" parameterType="String" resultType="ReservationDTO">
		select * from gr_reservation
		where mb_id = #{mb_id}
		order by RE_DATE desc
	</select>
	
	<select id="selectByNum" parameterType="int" resultType="ReservationDTO">
		select * from gr_reservation
		where de_licencenum = #{de_licencenum}
	</select>
	
	<!-- 예약 승인 | 미승인 -->
	<update id="checkReserv">
		update gr_reservation
		set RE_APPROVAL = #{RE_APPROVAL}
		where re_num = #{re_num};
	</update>
	
	<!-- 미승인 사유 작성 -->
	<insert id="insertFeedBack">
		insert into res_because
		values #{re_num}, #{bc_con} 
	</insert>
	
	<!-- 예약 작성 -->
	<insert id="insertReserv"><!-- 예약 번호는 자동 생성 -->
		insert into gr_reservation (de_licencenum, mb_id, re_approval, re_date, 
									re_nowdate,	re_species, re_weight, re_cut)
		values (#{de_licencenum}, #{mb_id, 'U', #{re_date}, 
				now(), #{re_species}, #{re_weight}, #{re_cut})
	</insert>
	
</mapper>